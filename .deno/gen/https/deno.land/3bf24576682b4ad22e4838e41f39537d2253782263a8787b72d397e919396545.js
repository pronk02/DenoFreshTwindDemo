export const INTERNAL_PREFIX = "/_frsh";
export const ASSET_CACHE_BUST_KEY = "__frsh_c";
export const IS_BROWSER = typeof document !== "undefined";
/**
 * Create a "locked" asset path. This differs from a plain path in that it is
 * specific to the current version of the application, and as such can be safely
 * served with a very long cache lifetime (1 year).
 */ export function asset(path) {
    if (!path.startsWith("/") || path.startsWith("//")) return path;
    try {
        const url = new URL(path, "https://freshassetcache.local");
        if (url.protocol !== "https:" || url.host !== "freshassetcache.local" || url.searchParams.has(ASSET_CACHE_BUST_KEY)) {
            return path;
        }
        url.searchParams.set(ASSET_CACHE_BUST_KEY, __FRSH_BUILD_ID);
        return url.pathname + url.search + url.hash;
    } catch (err) {
        console.warn(`Failed to create asset() URL, falling back to regular path ('${path}'):`, err);
        return path;
    }
}
/** Apply the `asset` function to urls in a `srcset` attribute. */ export function assetSrcSet(srcset) {
    if (srcset.includes("(")) return srcset; // Bail if the srcset contains complicated syntax.
    const parts = srcset.split(",");
    const constructed = [];
    for (const part of parts){
        const trimmed = part.trimStart();
        const leadingWhitespace = part.length - trimmed.length;
        if (trimmed === "") return srcset; // Bail if the srcset is malformed.
        let urlEnd = trimmed.indexOf(" ");
        if (urlEnd === -1) urlEnd = trimmed.length;
        const leading = part.substring(0, leadingWhitespace);
        const url = trimmed.substring(0, urlEnd);
        const trailing = trimmed.substring(urlEnd);
        constructed.push(leading + asset(url) + trailing);
    }
    return constructed.join(",");
}
export function assetHashingHook(vnode) {
    if (vnode.type === "img" || vnode.type === "source") {
        const { props  } = vnode;
        if (props["data-fresh-disable-lock"]) return;
        if (typeof props.src === "string") {
            props.src = asset(props.src);
        }
        if (typeof props.srcset === "string") {
            props.srcset = assetSrcSet(props.srcset);
        }
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImh0dHBzOi8vZGVuby5sYW5kL3gvZnJlc2hAMS4wLjEvc3JjL3J1bnRpbWUvdXRpbHMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgVk5vZGUgfSBmcm9tIFwicHJlYWN0XCI7XG5cbmV4cG9ydCBjb25zdCBJTlRFUk5BTF9QUkVGSVggPSBcIi9fZnJzaFwiO1xuZXhwb3J0IGNvbnN0IEFTU0VUX0NBQ0hFX0JVU1RfS0VZID0gXCJfX2Zyc2hfY1wiO1xuXG5leHBvcnQgY29uc3QgSVNfQlJPV1NFUiA9IHR5cGVvZiBkb2N1bWVudCAhPT0gXCJ1bmRlZmluZWRcIjtcblxuLyoqXG4gKiBDcmVhdGUgYSBcImxvY2tlZFwiIGFzc2V0IHBhdGguIFRoaXMgZGlmZmVycyBmcm9tIGEgcGxhaW4gcGF0aCBpbiB0aGF0IGl0IGlzXG4gKiBzcGVjaWZpYyB0byB0aGUgY3VycmVudCB2ZXJzaW9uIG9mIHRoZSBhcHBsaWNhdGlvbiwgYW5kIGFzIHN1Y2ggY2FuIGJlIHNhZmVseVxuICogc2VydmVkIHdpdGggYSB2ZXJ5IGxvbmcgY2FjaGUgbGlmZXRpbWUgKDEgeWVhcikuXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBhc3NldChwYXRoOiBzdHJpbmcpIHtcbiAgaWYgKCFwYXRoLnN0YXJ0c1dpdGgoXCIvXCIpIHx8IHBhdGguc3RhcnRzV2l0aChcIi8vXCIpKSByZXR1cm4gcGF0aDtcbiAgdHJ5IHtcbiAgICBjb25zdCB1cmwgPSBuZXcgVVJMKHBhdGgsIFwiaHR0cHM6Ly9mcmVzaGFzc2V0Y2FjaGUubG9jYWxcIik7XG4gICAgaWYgKFxuICAgICAgdXJsLnByb3RvY29sICE9PSBcImh0dHBzOlwiIHx8IHVybC5ob3N0ICE9PSBcImZyZXNoYXNzZXRjYWNoZS5sb2NhbFwiIHx8XG4gICAgICB1cmwuc2VhcmNoUGFyYW1zLmhhcyhBU1NFVF9DQUNIRV9CVVNUX0tFWSlcbiAgICApIHtcbiAgICAgIHJldHVybiBwYXRoO1xuICAgIH1cbiAgICB1cmwuc2VhcmNoUGFyYW1zLnNldChBU1NFVF9DQUNIRV9CVVNUX0tFWSwgX19GUlNIX0JVSUxEX0lEKTtcbiAgICByZXR1cm4gdXJsLnBhdGhuYW1lICsgdXJsLnNlYXJjaCArIHVybC5oYXNoO1xuICB9IGNhdGNoIChlcnIpIHtcbiAgICBjb25zb2xlLndhcm4oXG4gICAgICBgRmFpbGVkIHRvIGNyZWF0ZSBhc3NldCgpIFVSTCwgZmFsbGluZyBiYWNrIHRvIHJlZ3VsYXIgcGF0aCAoJyR7cGF0aH0nKTpgLFxuICAgICAgZXJyLFxuICAgICk7XG4gICAgcmV0dXJuIHBhdGg7XG4gIH1cbn1cblxuLyoqIEFwcGx5IHRoZSBgYXNzZXRgIGZ1bmN0aW9uIHRvIHVybHMgaW4gYSBgc3Jjc2V0YCBhdHRyaWJ1dGUuICovXG5leHBvcnQgZnVuY3Rpb24gYXNzZXRTcmNTZXQoc3Jjc2V0OiBzdHJpbmcpOiBzdHJpbmcge1xuICBpZiAoc3Jjc2V0LmluY2x1ZGVzKFwiKFwiKSkgcmV0dXJuIHNyY3NldDsgLy8gQmFpbCBpZiB0aGUgc3Jjc2V0IGNvbnRhaW5zIGNvbXBsaWNhdGVkIHN5bnRheC5cbiAgY29uc3QgcGFydHMgPSBzcmNzZXQuc3BsaXQoXCIsXCIpO1xuICBjb25zdCBjb25zdHJ1Y3RlZCA9IFtdO1xuICBmb3IgKGNvbnN0IHBhcnQgb2YgcGFydHMpIHtcbiAgICBjb25zdCB0cmltbWVkID0gcGFydC50cmltU3RhcnQoKTtcbiAgICBjb25zdCBsZWFkaW5nV2hpdGVzcGFjZSA9IHBhcnQubGVuZ3RoIC0gdHJpbW1lZC5sZW5ndGg7XG4gICAgaWYgKHRyaW1tZWQgPT09IFwiXCIpIHJldHVybiBzcmNzZXQ7IC8vIEJhaWwgaWYgdGhlIHNyY3NldCBpcyBtYWxmb3JtZWQuXG4gICAgbGV0IHVybEVuZCA9IHRyaW1tZWQuaW5kZXhPZihcIiBcIik7XG4gICAgaWYgKHVybEVuZCA9PT0gLTEpIHVybEVuZCA9IHRyaW1tZWQubGVuZ3RoO1xuICAgIGNvbnN0IGxlYWRpbmcgPSBwYXJ0LnN1YnN0cmluZygwLCBsZWFkaW5nV2hpdGVzcGFjZSk7XG4gICAgY29uc3QgdXJsID0gdHJpbW1lZC5zdWJzdHJpbmcoMCwgdXJsRW5kKTtcbiAgICBjb25zdCB0cmFpbGluZyA9IHRyaW1tZWQuc3Vic3RyaW5nKHVybEVuZCk7XG4gICAgY29uc3RydWN0ZWQucHVzaChsZWFkaW5nICsgYXNzZXQodXJsKSArIHRyYWlsaW5nKTtcbiAgfVxuICByZXR1cm4gY29uc3RydWN0ZWQuam9pbihcIixcIik7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBhc3NldEhhc2hpbmdIb29rKFxuICB2bm9kZTogVk5vZGU8e1xuICAgIHNyYz86IHN0cmluZztcbiAgICBzcmNzZXQ/OiBzdHJpbmc7XG4gICAgW1wiZGF0YS1mcmVzaC1kaXNhYmxlLWxvY2tcIl0/OiBib29sZWFuO1xuICB9Pixcbikge1xuICBpZiAodm5vZGUudHlwZSA9PT0gXCJpbWdcIiB8fCB2bm9kZS50eXBlID09PSBcInNvdXJjZVwiKSB7XG4gICAgY29uc3QgeyBwcm9wcyB9ID0gdm5vZGU7XG4gICAgaWYgKHByb3BzW1wiZGF0YS1mcmVzaC1kaXNhYmxlLWxvY2tcIl0pIHJldHVybjtcbiAgICBpZiAodHlwZW9mIHByb3BzLnNyYyA9PT0gXCJzdHJpbmdcIikge1xuICAgICAgcHJvcHMuc3JjID0gYXNzZXQocHJvcHMuc3JjKTtcbiAgICB9XG4gICAgaWYgKHR5cGVvZiBwcm9wcy5zcmNzZXQgPT09IFwic3RyaW5nXCIpIHtcbiAgICAgIHByb3BzLnNyY3NldCA9IGFzc2V0U3JjU2V0KHByb3BzLnNyY3NldCk7XG4gICAgfVxuICB9XG59XG4iXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBRUEsT0FBTyxNQUFNLGVBQWUsR0FBRyxRQUFRLENBQUM7QUFDeEMsT0FBTyxNQUFNLG9CQUFvQixHQUFHLFVBQVUsQ0FBQztBQUUvQyxPQUFPLE1BQU0sVUFBVSxHQUFHLE9BQU8sUUFBUSxLQUFLLFdBQVcsQ0FBQztBQUUxRDs7OztHQUlHLENBQ0gsT0FBTyxTQUFTLEtBQUssQ0FBQyxJQUFZ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